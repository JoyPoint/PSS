#!/bin/bash

echo "checking ace env begin..."
PSS_PATH=`pwd`
ACE_PATH_ENV=$ACE_ROOT
echo $ACE_PATH_ENV
if [ "$ACE_PATH_ENV"x = ""x ]; then
	echo "ace no find"
	if [ ! -f "ACE-6.5.0.tar.gz" ]; then
		echo "download file is no exist"
		echo "begin auto download ace packet begin..."
		wget http://download.dre.vanderbilt.edu/previous_versions/ACE-6.5.0.tar.gz
		echo "begin auto download ace packet end..."
	fi

	if [ ! -d '../third_libs' ]; then
		mkdir ../third_libs
	fi

	echo "unzip ace packet begin..."
	tar zxvf ACE-6.5.0.tar.gz -C ../third_libs/
	echo "unzip ace packet end..."
	echo "config bash_profile begin..."
	cd ../third_libs
	ACE_UZIP_PATH=`pwd`
	ACE_THIRD_ROOT=$ACE_UZIP_PATH/ACE_wrappers/
	echo $ACE_THIRD_ROOT
	echo -e "ACE_ROOT=$ACE_THIRD_ROOT" >> ~/.bash_profile
	echo -e "export ACE_ROOT" >> ~/.bash_profile
	echo -e 'LD_LIBRARY_PATH=$ACE_ROOT/lib:$LD_LIBRARY_PATH' >> ~/.bash_profile
	echo -e 'export LD_LIBRARY_PATH' >> ~/.bash_profile
	echo -e 'PATH=$PATH:$ACE_ROOT/bin' >> ~/.bash_profile
	echo -e 'export PATH' >> ~/.bash_profile
	source ~/.bash_profile
	echo $ACE_ROOT
	echo "config bash_profile end..."
	echo "config ace begin..."
	echo -e "#include \"ace/config-linux.h\"" > $ACE_THIRD_ROOT/ace/config.h
	echo -e "#define ACE_HAS_EVENT_POLL" >> $ACE_THIRD_ROOT/ace/config.h
	echo -e "include \$(ACE_ROOT)/include/makeinclude/platform_linux.GNU" > $ACE_THIRD_ROOT/include/makeinclude/platform_macros.GNU
	echo "config ace end..."
	echo "compire ace begin..."
	cd $ACE_THIRD_ROOT\ace
	make
	echo "compire ace end..."
fi
echo "checking ace env end..."
echo "create PSS make begin..."
echo $PSS_PATH/runlinuxmpc.sh
sh $PSS_PATH/runlinuxmpc.sh
echo "create PSS make end..."	
echo "PSS make begin..."
cd $PSS_PATH
make
echo "PSS make end..."	

